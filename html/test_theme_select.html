<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>主题色选择器</title>
    <style id="style-css">
      /* ------------------ 样式定义 (CSS) ------------------ */
      :root {
        /* 1. 唯一的全局主题色变量，默认为 HSL 格式 */
        --theme-color: hsl(165, 100%, 50%);

        --bar-height: 20px;
        --handle-size: 10px;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
      }

      .color-picker-container {
        width: 300px;
        padding: 15px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        font-family: sans-serif;
        border: 2px solid var(--theme-color);
      }

      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .label {
        font-size: 16px;
        color: #333;
      }

      .value {
        padding: 5px 10px;
        background-color: var(--theme-color);
        color: white;
        border-radius: 6px;
        font-weight: bold;
      }

      .gradient-bar {
        position: relative;
        height: var(--bar-height);
        border-radius: var(--bar-height);
        cursor: pointer;

        /* ✅ 修正后的核心：使用 HSL() 定义精确的色相环渐变 */
        background: linear-gradient(
          to right,
          hsl(0, 100%, 70%) 0%,
          hsl(60, 100%, 70%) 16.67%,
          hsl(120, 100%, 70%) 33.33%,
          hsl(180, 100%, 70%) 50%,
          hsl(240, 100%, 70%) 66.67%,
          hsl(300, 100%, 70%) 83.33%,
          hsl(360, 100%, 70%) 100%
        );
      }

      .color-handle {
        position: absolute;
        top: calc(50% - var(--handle-size) / 2);
        width: var(--handle-size);
        height: calc(var(--bar-height) * 1.5);
        background-color: white;
        border: 3px solid white;
        border-radius: 2px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        border-left: 2px solid #555;
        border-right: 2px solid #555;
        transform: translateX(-50%);
        pointer-events: none;
      }

      .preview-button {
        margin-top: 20px;
        padding: 10px 15px;
        background-color: var(--theme-color);
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
    </style>
  </head>
  <body>
    <div class="color-picker-container">
      <div class="header">
        <span class="label">主题色</span>
        <span id="color-value" class="value">165</span>
      </div>
      <div id="gradient-bar" class="gradient-bar">
        <div id="color-handle" class="color-handle"></div>
      </div>
      <button class="preview-button">预览按钮 (随主题色变化)</button>
    </div>

    <script id="script-js">
      /* ------------------ 逻辑实现 (JavaScript) ------------------ */
      document.addEventListener("DOMContentLoaded", () => {
        const bar = document.getElementById("gradient-bar");
        const handle = document.getElementById("color-handle");
        const valueDisplay = document.getElementById("color-value");

        // 获取文档根元素，用于设置全局 CSS 变量
        const root = document.documentElement;

        let isDragging = false;

        /**
         * 根据鼠标位置更新指示器位置、色相值和主题色变量
         * @param {number} clientX - 鼠标的 X 坐标
         */
        function updateHandlePosition(clientX) {
          const barRect = bar.getBoundingClientRect();

          // 1. 计算相对位置
          let relativeX = clientX - barRect.left;

          // 限制在边界内 [0, barWidth]
          if (relativeX < 0) {
            relativeX = 0;
          } else if (relativeX > barRect.width) {
            relativeX = barRect.width;
          }

          // 2. 计算百分比位置 (0到1)
          const percentage = relativeX / barRect.width;

          // 3. 计算色相值 (Hue: 0到360)
          const maxValue = 360;
          const hueValue = Math.round(percentage * maxValue);

          // 4. 计算完整的 HSL 颜色字符串 (饱和度S=100%, 亮度L=50%)
          const colorString = `hsl(${hueValue}, 100%, 70%)`;

          // 5. 更新 DOM
          handle.style.left = `${relativeX}px`;
          valueDisplay.textContent = hueValue;
          handle.style.backgroundColor = colorString;

          // 6. ***核心：设置单个 CSS 变量***
          // 变量名为 --theme-color，值是完整的 HSL 字符串
          root.style.setProperty("--theme-color", colorString);
        }

        // --- 事件处理函数 ---
        const startDrag = (e) => {
          isDragging = true;
          e.preventDefault();
          updateHandlePosition(e.clientX);
        };

        const doDrag = (e) => {
          if (isDragging) {
            updateHandlePosition(e.clientX);
          }
        };

        const stopDrag = () => {
          isDragging = false;
        };

        // --- 绑定事件 ---
        bar.addEventListener("mousedown", startDrag);
        document.addEventListener("mousemove", doDrag);
        document.addEventListener("mouseup", stopDrag);

        // --- 初始设置 ---
        const initialHue = 165; // 默认值
        const initialPercentage = initialHue / 360;

        // 延迟执行以确保 barRect 已经计算出正确的宽度
        setTimeout(() => {
          const barWidth = bar.getBoundingClientRect().width;
          const initialX = barWidth * initialPercentage;

          // 模拟鼠标点击到初始位置，以初始化显示和变量
          updateHandlePosition(bar.getBoundingClientRect().left + initialX);
        }, 0);
      });
    </script>
  </body>
</html>
